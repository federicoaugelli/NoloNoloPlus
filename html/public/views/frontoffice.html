<!doctype html>
<html lang="it">
  <head>
      <title>Frontoffice</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      
      <!-- Bootstrap CDN -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/underscore@1.13.2/underscore-umd-min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
      <script src="//code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <link rel="shortcut icon" href="#">

      <!-- vue.js CDN
      <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
      -->

      <!-- vue.js -->
      <script type="text/javascript" src="/js/vue.min.js"></script>
      <link rel="stylesheet" type="text/css" href="/css/frontoffice.css">
      <link rel="stylesheet" type="text/css" href="/css/login.css">
      <script type="text/javascript" src="/js/frontoffice.js"></script>


</head>

<body style="background-color: #031336;">
  <div id="app">

                                                   <!-- MODAL-FLASH -->

<div class="modal fade" id="flash-modal" tabindex="-1" aria-labelledby="flash-modalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="flash-modalLabel"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-primary d-flex align-items-center" role="alert">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
          </svg>
          <div  id="alert-body">
           
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" id="closeFlashModal" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
                                               <!-- FINE MODAL-FLASH -->




  <!-- The Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="ModalLogin" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered" role="document">
       <div class="modal-content form-elegant">
    <!-- Modal body -->
       <div class="modal-body p-0">
        
        <div class="row">
          <div class="">
            <div class="card">
              <div class="login-box">
                <div class="login-snip"> 
                  <input id="tab-1" type="radio" name="tab" class="sign-in" checked>
                  <label for="tab-1" class="tab">Accedi</label> 
                  <input id="tab-2" type="radio" name="tab" class="sign-up">
                  <label for="tab-2" class="tab">Registrati</label>
                  <div class="login-space">
                    <div class="login">
                      <form action="/docs/frontend" method="POST">
                      <div class="group"> <label id="ariaUser" for="username" class="label">Username</label> <input id="username" type="text" name="username" class="input" placeholder="Inserisci il tuo username" aria-describedby="ariaUser" required> </div>
                      <div class="group"> <label id="ariaPwd" for="password" class="label">Password</label> <input id="password" type="password" name="password" class="input" data-type="password" placeholder="Inserisci la tua password" aria-describedby="ariaPwd" required> </div>
                      <div class="group"> <input type="submit" class="button" value="Accedi"> </div>
                      <div class="hr"></div>
                    </div>
                  </form>
                    <div class="sign-up-form">
                      <form action="/db/registerCliente" method="POST" id="createUserForm">
                      <div class="group"> <label id="ariaNome" for="nome" class="label">Nome</label> <input id="nome" type="text" name="nome" class="input" placeholder="Inserisci il tuo nome" aria-describedby="ariaNome" required> </div>
                      <div class="group"> <label id="ariaCognome" for="cognome" class="label">Cognome</label> <input id="cognome" type="text" name="cognome" class="input" placeholder="Inserisci il tuo cognome" aria-describedby="ariaCognome" required> </div>
                      <div class="group"> <label id="ariaUsr" for="username" class="label">Username</label> <input id="username" type="text" name="username" class="input" placeholder="Crea il tuo Username" aria-describedby="ariaUsr" required> </div>
                      <div class="group"> <label id="ariaPwd1" for="password" class="label">Password</label> <input id="password" type="password" name="password" class="input" data-type="password" placeholder="Crea nuova password" aria-describedby="ariaPwd1" required> </div>
                      <div class="row g-3">
                        <div class="col-sm-8">
                      <div class="group"><label id="ariaVia" for="via" class="label">Via</label> <input id="via" type="text" name="via" class="input" placeholder=" Via, Numero " aria-describedby="ariaVia" required> </div>
                        </div>
                        <div class="col-sm-4">
                          <div class="group"><label id="ariaCity" for="citta" class="label"> Citt&agrave;</label> <input id="citta" type="text" name="citta" class="input" placeholder=" Città " aria-describedby="ariaCity" required> </div>
                        </div>
                      </div>
                      <div class="group"> <button type="button" class="button" onclick="registerCliente()" aria-label="registrati come cliente"> Registrati </button></div>
                      <div class="hr"></div>
                      <div class="foot"> <label for="tab-1">Already Member?</label> </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
       </div>
       </div>
     </div> 
  </div> 



  <!-- NAVBAR -->
    <nav class="navbar navbar-dark navbar-expand-md bg-primary sticky-top py-4" id="navbarTitle">
      <div style="margin-right: 10px; margin-left: 10px;" class="container-fluid">
        <a class="navbar-brand ml-auto">NOLO NOLO</a>
        </button>
          <form class="d-flex w-50 bottom-0 my-auto d-none d-lg-block">
            <input class="form-control me-2" type="search" placeholder="Cerca" aria-label="inserisci la tua parola chiave di ricerca" v-model="searchQuery">
          </form>
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">            
              <!-- Modal button-->
              <button type="button" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#myModal" onclick="showHideLoginRegister()">Accedi</button>  
            </li>
          </ul> 
      </div>
    </nav>

  <div v-if="show == true" v-model="removeDuplicates(), show = false"></div>

  <!-- TABELLA FINALE -->
  <div class="album py-5">
    <div class="container">
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
        <div class="col" v-for="(item, index) in resultQuery" :key="index">
          <!-- implementare card 'Nessun elemento' -->
          <div class="card shadow-sm gameCard" style="text-align: center;">
            <div class="pegi">PEGI {{ item.etaMinima }}</div>
            <img v-if="item.platform == 'Playstation 4' || item.platform == 'Playstation 5'" class="platform-logo playstation" src="/img/playstation-brands.svg" alt="Card image1">
            <img v-else-if="item.platform == 'Xbox One' || item.platform == 'Xbox Serie X/S'" class="platform-logo xbox" src="/img/xbox-brands.svg" alt="Card image1">
            <img v-else-if="item.platform == 'Pc'" class="platform-logo pc" src="/img/laptop-solid.svg" alt="Card image1">
            <img class="card-img-top" :src=item.img alt="Card image1">
            <div class="card-body">
              <h4 class="card-title" style="color: white;">{{ item.game }}</h4>
              <!--
              <a class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#card-modal">Noleggia</a>-->
              <a data-bs-toggle="modal" data-bs-target="#card-modal" class="rentbtn" v-on:click="popoModal(item)"true>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                Noleggia
              </a>
              <h6 style="color: white; margin-top: 10px;">{{ item.prezzo }}€ al giorno</h6>
            </div>
            <div class="card-footer">
              <small class="text-muted" style="position: absolute; right: 0; margin-right: 10px;">{{ item.annoUscita }}</small>
              <small class="text-muted">in {{ item.condizioni }} condizioni</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

      <!-- modal finale -->
   <div class="modal fade" id="card-modal" tabindex="-1" aria-labelledby="card-modalLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">{{ modalItem.game }} per {{ modalItem.platform }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" v-on:click="ipoteticalPrice = 0"></button>
        </div>
        <div class="modal-body">
          <div class="card-body">
            <label for="startRent">Da:</label>
            <input type="date" id="startRent" name="startRent" v-model="startDate">

            <label for="finishRent">A:</label>
            <input type="date" id="finishRent" name="finishRent" v-model="endDate">
          </div>
        </div>
        <div class="modal-footer">
          <p v-if="ipoteticalPrice > 0 && ipoteticalPrice != '' && ipoteticalPrice != 'err'" class="me-auto">costo: {{ ipoteticalPrice }}€</p>
          <p v-else-if="ipoteticalPrice == 'err'" class="me-auto" style="color: red;">Errore</p>
          <p v-else-if="ipoteticalPrice < 0" class="me-auto" style="color: red;">Errore</p>

          <button type="button" class="btn btn-primary" class="me-auto" v-on:click="calculateDate()">ipotesi</button>
          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">Accedi per noleggiare</button>
        </div>
      </div>
    </div>
  </div>


 </div>

  <script type="text/javascript">
      
    new Vue({
      el: "#app",
      data () {
        return {
          searchQuery: '',
          items: '',
          modalItem: '',
          startDate: '',
          endDate: '',
          ipoteticalPrice: '',
          showModal: false,
          show: true
        }
      },

      beforeMount () {
        axios
          .get('/db/getGames')
          .then(response => (this.items = response.data.result));
      },

      computed: {
        resultQuery(){
          if(this.searchQuery){
            return this.items.filter((gg)=>{
              return this.searchQuery.toLowerCase().split(' ').every(v => gg.game.toLowerCase().includes(v))
            })
          }
          else{
            return this.items;
          }
        },
      },

      methods: {

        //rimuove i duplicati di stessi giochi... vincolo del progetto
        removeDuplicates(){
          var cleaned = [];
          this.items.forEach(function(itm) {
            var unique = true;
            cleaned.forEach(function(itm2) {
              if (_.isEqual(itm.game, itm2.game)) unique = false;
            });
            if (unique)  cleaned.push(itm);
          });
          this.items = cleaned;
          console.log(this.items);
        },

        //funzione per variabili
        popoModal(item){
          this.modalItem = item;
        },

        //funzioni per il calcolo delle date
        parseDate(date){
          var mdy = date.split('-');
          return new Date(mdy[0], mdy[1], mdy[2]);
        },

        //funzioni per il calcolo delle date
        datediff(first, second) {
          return Math.round((second-first)/(1000*60*60*24));
        },

        //funzione che calcola la data... senza check sulle disponibilità
        calculateDate(){
          let yourDate = new Date().toISOString().split('T')[0];
          //console.log(yourDate);
          //console.log(this.startDate);
          //console.log(yourDate.split('-'));
          console.log(this.datediff(this.parseDate(yourDate), this.parseDate(this.startDate)));
          //console.log(this.datediff(this.parseDate(this.startDate), yourDate.split('-')));
          if(this.datediff(this.parseDate(this.startDate), this.parseDate(this.endDate)) > 0 && this.datediff(this.parseDate(yourDate), this.parseDate(this.startDate)) >= 0){
            this.ipoteticalPrice = parseFloat(this.modalItem.prezzo) * (this.datediff(this.parseDate(this.startDate), this.parseDate(this.endDate)));
            this.ipoteticalPrice = this.ipoteticalPrice.toFixed(2);
          }
          else if(this.datediff(this.parseDate(this.startDate), this.parseDate(this.endDate)) <= 0){
            this.ipoteticalPrice = -1
          }
          else{
            this.ipoteticalPrice = 'err'
          }
        },
      },
    })

  </script>
</div>
</body>
</html>